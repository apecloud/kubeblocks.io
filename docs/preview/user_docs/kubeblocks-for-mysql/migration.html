<!doctype html>
<html lang="en-US" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-user_docs/kubeblocks-for-mysql/migration/migration">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Migrate data to ApeCloud MySQL by AWS DMS | Kubeblocks</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://kubeblocks.io/docs/preview/user_docs/kubeblocks-for-mysql/migration"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Migrate data to ApeCloud MySQL by AWS DMS | Kubeblocks"><meta data-rh="true" name="description" content="How to migrate data to ApeCloud MySQL by AWS DMS"><meta data-rh="true" property="og:description" content="How to migrate data to ApeCloud MySQL by AWS DMS"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://kubeblocks.io/docs/preview/user_docs/kubeblocks-for-mysql/migration"><link data-rh="true" rel="alternate" href="https://kubeblocks.io/docs/preview/user_docs/kubeblocks-for-mysql/migration" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://kubeblocks.io/docs/preview/user_docs/kubeblocks-for-mysql/migration" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://SES9RBYTIC-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Kubeblocks RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Kubeblocks Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1P80WT42PB"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-1P80WT42PB",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Kubeblocks" href="/opensearch.xml">


<script src="/js/contacts.js"></script><link rel="stylesheet" href="/assets/css/styles.0f81d136.css">
<link rel="preload" href="/assets/js/runtime~main.3b99a02e.js" as="script">
<link rel="preload" href="/assets/js/main.13f99fa4.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/preview/user_docs/introduction">Documentation</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/apecloud/kubeblocks" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_gi4H"><div class="Dropdown-root"><div class="Dropdown-control" aria-haspopup="listbox"><div class="Dropdown-placeholder is-selected"><span class="Dropdown-control-label">Version: <!-- -->release-0.4</span></div><div class="Dropdown-arrow-wrapper"><span class="Dropdown-arrow"></span></div></div></div><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/preview/user_docs/introduction">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/preview/user_docs/quick-start/try-kubeblocks-functions-on-cloud">Quick Start</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/preview/user_docs/installation/install-and-uninstall-kbcli-and-kubeblocks">Installation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/preview/user_docs/kubeblocks-for-mysql/apecloud-mysql-intro">KubeBlocks for MySQL</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/preview/user_docs/kubeblocks-for-mysql/apecloud-mysql-intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/preview/user_docs/kubeblocks-for-mysql/cluster-management/create-and-connect-a-mysql-cluster">Cluster Management</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/preview/user_docs/kubeblocks-for-mysql/configuration">Configuration</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/preview/user_docs/kubeblocks-for-mysql/backup-and-restore/backup-and-restore-for-mysql-standalone">Backup and Restore</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/preview/user_docs/kubeblocks-for-mysql/observability/monitor-database">Observability</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/preview/user_docs/kubeblocks-for-mysql/high-availability">High Availability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/preview/user_docs/kubeblocks-for-mysql/migration">Migration</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/preview/user_docs/kubeblocks-for-postgresql/cluster-management/create-and-connect-a-postgresql-cluster">KubeBlocks for PostgreSQL</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/preview/user_docs/connect_database/overview-of-database-connection">Connect Database</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/preview/user_docs/resource-scheduling">Resource Scheduling</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed hide-children"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/preview/user_docs/cli">Command Line</a><button aria-label="Toggle the collapsible sidebar category &#x27;Command Line&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/preview/user_docs/api/lifecycle-management/lifecycle-management-api">KubeBlocks API</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/preview/user_docs">README</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Kubeblocks<!-- --> <b>Preview</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/release-0.4/user_docs/kubeblocks-for-mysql/migration">latest version</a></b> (<!-- -->release-0.4<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">KubeBlocks for MySQL</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Migration</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Preview</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Migrate data to ApeCloud MySQL by AWS DMS</h1><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><ul><li>Using the public network and network load balancer causes extra fees.</li><li>The following tutorial is based on the prerequisite that ApeCloud MySQL is deployed on AWS EKS. Using other Kubernetes clusters to deploy ApeCloud MySQL is not included.</li></ul></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-network-configuration">Step 1. Network configuration<a href="#step-1-network-configuration" class="hash-link" aria-label="Direct link to Step 1. Network configuration" title="Direct link to Step 1. Network configuration">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="expose-the-target-apecloud-mysql-network">Expose the target ApeCloud MySQL network<a href="#expose-the-target-apecloud-mysql-network" class="hash-link" aria-label="Direct link to Expose the target ApeCloud MySQL network" title="Direct link to Expose the target ApeCloud MySQL network">​</a></h3><p>The Kubernetes ClusterIP of ApeCloud MySQL is exposed by default in the EKS environment. But the migration task of DMS  (Database Migration Service) runs in an independent Replication Instance, in which the Replication Instance can be set with the same VPC used by the Kubernetes clusters, but visiting ClusterIP still fails. This solution aims to connect this part of the network.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="kubeblocks-native-solution">KubeBlocks native solution<a href="#kubeblocks-native-solution" class="hash-link" aria-label="Direct link to KubeBlocks native solution" title="Direct link to KubeBlocks native solution">​</a></h4><ol><li><p>Check whether the loadbalancer add-on is enabled.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kbcli addon list</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If the loadbalancer is disabled, it may relate to your environment since the loadbalancer add-on relies on the EKS environment.
Build your EKS environment, and refer to <a href="/docs/preview/user_docs/installation/enable-add-ons">Enable add-ons</a> to enable the loadbalancer add-on.</p></li><li><p>Install ApeCloud MySQL. Refer to <a href="/docs/preview/quick-start/create-a-mysql-cluster-on-aws.md">Create an ApeCloud MySQL cluster on AWS</a> for details.</p></li><li><p>Fill in the cluster name and run the command below to expose the external IP of the cluster.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kbcli cluster expose </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${mysql clustrName}</span><span class="token plain"> --enable</span><span class="token operator">=</span><span class="token plain">true --type</span><span class="token operator">=</span><span class="token plain">vpc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Run the command below to view the external IP:Port address which can be accessed by the same VPC machine but outside the EKS cluster.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kbcli cluster describe </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${clustrName}</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">grep</span><span class="token plain"> -A </span><span class="token number">3</span><span class="token plain"> Endpoints</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong><em>Example</em></strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">KBCLI_EXPERIMENTAL_EXPOSE</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;1&quot;</span><span class="token plain"> kb cluster expose mysql-cluster --on</span><span class="token operator">=</span><span class="token plain">true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kbcli cluster describe mysql-cluster </span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">grep</span><span class="token plain"> -A </span><span class="token number">3</span><span class="token plain"> Endpoints</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Endpoints:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">COMPONENT       MODE            INTERNAL                EXTERNAL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql           ReadWrite       </span><span class="token number">10.100</span><span class="token plain">.51.xxx:3306      </span><span class="token number">172.31</span><span class="token plain">.35.xxx:3306 </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Configure the external IP:Port as the target endpoint on AWS DMS.
This operation generates an ENI (Elastic Network Interface) on EC2. If the quota of the low-spec machine is small, pay more attention to the available level of ENI.
For the corresponding ENI specifications, refer to <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html" target="_blank" rel="noopener noreferrer">Elastic network interfaces - Amazon Elastic Compute Cloud</a>.</p></li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="use-network-load-balancer-nlb-to-expose-the-service">Use Network Load Balancer (NLB) to expose the service<a href="#use-network-load-balancer-nlb-to-expose-the-service" class="hash-link" aria-label="Direct link to Use Network Load Balancer (NLB) to expose the service" title="Direct link to Use Network Load Balancer (NLB) to expose the service">​</a></h4><ol><li><p>Install Load Balancer Controller on EKS.
For installation details, refer to <a href="https://docs.aws.amazon.com/eks/latest/userguide/aws-load-balancer-controller.html" target="_blank" rel="noopener noreferrer">Installing the AWS Load Balancer Controller add-on</a>.
For how to create NLB in a cluster, refer to <a href="https://docs.aws.amazon.com/eks/latest/userguide/network-load-balancing.html" target="_blank" rel="noopener noreferrer">Network load balancing on Amazon EKS</a>.</p></li><li><p>Create and use the NLB service to expose the ApeCloud MySQL service.
Configure <code>metadata.name</code>, <code>metadata.annotations</code>, <code>metadata.labels</code>, and <code>spec.selector</code> according to your actual environment.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">cat</span><span class="token plain"> </span><span class="token operator">&lt;&lt;</span><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><span class="token string bash punctuation" style="color:rgb(248, 248, 242)"> </span><span class="token string bash punctuation operator" style="color:rgb(248, 248, 242)">|</span><span class="token string bash punctuation" style="color:rgb(248, 248, 242)"> kubectl apply -f -</span><span class="token string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">kind: Service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">apiVersion: v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    name: mysql-service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    annotations:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        service.beta.kubernetes.io/aws-load-balancer-type: nlb-ip</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        alb.ingress.kubernetes.io/scheme: internet-facing</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        service.beta.kubernetes.io/aws-load-balancer-subnets: </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${subnet name1}</span><span class="token string" style="color:rgb(255, 121, 198)">,</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${subnet name2}</span><span class="token string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    labels:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      apps.kubeblocks.io/component-name: mysql</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      app.kubernetes.io/instance: </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${mysql clustername}</span><span class="token string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      app.kubernetes.io/managed-by: kubeblocks</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      app.kubernetes.io/name: apecloud-mysql     </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    externalTrafficPolicy: Cluster </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    type: LoadBalancer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    selector:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      apps.kubeblocks.io/component-name: mysql</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      app.kubernetes.io/instance: </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${mysql clustername}</span><span class="token string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      app.kubernetes.io/managed-by: kubeblocks</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      kubeblocks.io/role: leader</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    ports:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        - name: http</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          protocol: TCP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          port: 3306</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          targetPort: mysql </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Run the command below to make sure the service and NLB run normally.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl get svc </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME                  TYPE           CLUSTER-IP       EXTERNAL-IP                                        PORT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql-service         LoadBalancer   </span><span class="token number">10.100</span><span class="token plain">.xx.xx     k8s-xx-xx-xx.elb.cn-northwest-1.amazonaws.com.cn   </span><span class="token number">3306</span><span class="token plain">:xx/TCP</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Make sure the server runs normally and can generate EXTERNAL-IP. Meanwhile, verify whether the NLB state is <code>Active</code> by the AWS console, then you can access the cluster by EXTERNAL-IP:Port.
<img loading="lazy" alt="NLB-active" src="/assets/images/mysql_migration_active-7eba2bef9016d81bb675117cefd3dcc3.png" width="1280" height="574" class="img_ev3q"></p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="expose-the-source-network">Expose the source network<a href="#expose-the-source-network" class="hash-link" aria-label="Direct link to Expose the source network" title="Direct link to Expose the source network">​</a></h3><p>There exist four different conditions for the source network. Choose one method to expose the source network according to your actual environment.</p><ul><li><p>Alibaba Cloud ApsaraDB RDS</p><p> Use the public network. Refer to <a href="https://www.alibabacloud.com/help/en/apsaradb-for-rds/latest/apply-for-or-release-a-public-endpoint-for-an-apsaradb-rds-for-mysql-instance" target="_blank" rel="noopener noreferrer">Apply for or release a public endpoint for an ApsaraDB RDS for MySQL instance</a> to release a public endpoint then create an endpoint in AWS DMS.</p></li><li><p>RDS within the same VPC in AWS</p><p> You only need to specify an RDS when creating an endpoint in DMS and no extra operation is required.
For creating an endpoint, refer to step 2 in <a href="#step-2-configure-aws-dms-tasks">Configure AWS DMS tasks</a>.</p></li><li><p>RDS within different VPCs in AWS</p><p> Use the public network to create an endpoint. Refer to <a href="https://aws.amazon.com/premiumsupport/knowledge-center/aurora-mysql-connect-outside-vpc/?nc1=h_ls" target="_blank" rel="noopener noreferrer">this document</a> to make public network access available, then create an endpoint in AWS DMS. For creating an endpoint, refer to step 2 in <a href="#step-2-configure-aws-dms-tasks">Configure AWS DMS tasks</a>.</p></li><li><p>MySQL in AWS EKS</p><p> Use NLB to expose the service.</p><ol><li><p>Install Load Balancer Controller
For installation details, refer to <a href="https://docs.aws.amazon.com/eks/latest/userguide/aws-load-balancer-controller.html" target="_blank" rel="noopener noreferrer">Installing the AWS Load Balancer Controller add-on</a>.
For how to create NLB in a cluster, refer to <a href="https://docs.aws.amazon.com/eks/latest/userguide/network-load-balancing.html" target="_blank" rel="noopener noreferrer">Network load balancing on Amazon EKS</a>.</p></li><li><p>Create the service using NLB
Make sure the value of <code>some.label.key</code> in <code>metadata.labels</code> is consistent with the value of ApeCloud MySQL you created.
Configure <code>port</code> and <code>targetPort</code> in <code>spec.ports</code> according to your current environment.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">cat</span><span class="token plain"> </span><span class="token operator">&lt;&lt;</span><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><span class="token string bash punctuation" style="color:rgb(248, 248, 242)"> </span><span class="token string bash punctuation operator" style="color:rgb(248, 248, 242)">|</span><span class="token string bash punctuation" style="color:rgb(248, 248, 242)"> kubectl apply -f -</span><span class="token string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">kind: Service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">apiVersion: v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">metadata:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    name: mysql-local-service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    annotations:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        service.beta.kubernetes.io/aws-load-balancer-type: nlb-ip</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        alb.ingress.kubernetes.io/scheme: internet-facing</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        service.beta.kubernetes.io/aws-load-balancer-subnets: </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${subnet name1}</span><span class="token string" style="color:rgb(255, 121, 198)">,</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${subnet name2}</span><span class="token string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    labels:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    some.label.key: some-label-value    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">spec:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    externalTrafficPolicy: Cluster </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    type: LoadBalancer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    selector:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    some.label.key: some-label-value  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    ports:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        - name: http</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          protocol: TCP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          port: 3306</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">          targetPort: 3306 </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Make sure Service and NLB run normally.
Refer to step 3 in <a href="#use-network-load-balancer-nlb-to-expose-the-service">Use Network Load Balancer (NLB) to expose the service</a> for details.</p></li></ol></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-configure-aws-dms-tasks">Step 2. Configure AWS DMS tasks<a href="#step-2-configure-aws-dms-tasks" class="hash-link" aria-label="Direct link to Step 2. Configure AWS DMS tasks" title="Direct link to Step 2. Configure AWS DMS tasks">​</a></h2><p>Pay attention to the following potential issues during the migration task.</p><ul><li><p>Double write</p><p> During the migration, make sure no business is writing to the target data instance. Otherwise, double write occurs.</p></li><li><p>Disk space of the target instance</p><p> Since the transfer tool uses a concurrent write model when writing to the target database, out-of-order writes may occur, which may trigger page splitting and cause the data space of the target database to be slightly enlarged compared with that of the original instance. It is recommended to plan appropriately when allocating the storage size of the target database, for example, at least 1.5 times the current storage size of the source database.</p></li><li><p>DDL and onlineDDL</p><p> Locked structure changes often affect the speed of data migration.
The lock-free structure change is based on the rename of the temporary table in principle, which causes data problems if the migration object is not the whole database migration. For example, if the migration object chooses to migrate db1.table1 to the target, and an onlineDDL is performed on db1.table1 on the source database during the process, the data of db1.table1 on the target database will be inconsistent with the source database.
It should be noted that the way some database management tools initiate DDL is performed using lock-free mutation by default.
Migration is short-term behavior. To avoid unnecessary troubles, it is recommended not to perform DDL operations during the migration process.</p></li><li><p>binlog retention hours</p><p> The process of migrating data transmission changes depends on the binlog of the source database.
It is recommended to extend the binlog retention hours to avoid a long-term interruption and the situation that the binlog of the source database is cleared during recovery, resulting in the migration not being resumed.
For example, in AWS RDS, connect to the database and run the command below:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># View configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Input: </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">call mysql.rds_show_configuration</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Output: Pay attention to the binlog retention hours.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+------------------------+-------+-----------------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> name                   </span><span class="token operator">|</span><span class="token plain"> value </span><span class="token operator">|</span><span class="token plain"> description                                                                                               </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+------------------------+-------+-----------------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> binlog retention hours </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">8</span><span class="token plain">     </span><span class="token operator">|</span><span class="token plain"> binlog retention hours specifies the duration </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> hours before binary logs are automatically deleted.      </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">source</span><span class="token plain"> delay           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain">     </span><span class="token operator">|</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">source</span><span class="token plain"> delay specifies replication delay </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> seconds between current instance and its master.              </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">|</span><span class="token plain"> target delay           </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain">     </span><span class="token operator">|</span><span class="token plain"> target delay specifies replication delay </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> seconds between current instance and its future read-replica. </span><span class="token operator">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+------------------------+-------+-----------------------------------------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Adjust the retention hours to 72 hours</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Input:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">call mysql.rds_set_configuration</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;binlog retention hours&#x27;</span><span class="token plain">, </span><span class="token number">72</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><p><strong><em>Steps:</em></strong></p><ol><li><p>Create a Replication Instance for migration.</p><p>Go to <strong>DMS</strong> -&gt; <strong>Replication Instance</strong> and click <strong>Create replication instance</strong>. </p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>Select the VPC that you have configured in EKS.</p></div></div><p><img loading="lazy" alt="Create replication instance" src="/assets/images/mysql_migration_replication_instance-a58a7d42600a614be77865788975369b.png" width="1280" height="487" class="img_ev3q"></p></li><li><p>Create endpoints.</p><p>Go to <strong>DMS</strong> -&gt; <strong>Endpoints</strong> and click <strong>Create endpoint</strong>.</p><p><img loading="lazy" alt="Create endpoint" src="/assets/images/mysql_migration_create_endpoints-3704c7b36d3483601bccccd59733e08f.png" width="1280" height="363" class="img_ev3q"></p><p>Create the source endpoint and target endpoint respectively. If the target endpoint is the RDS instance, check <strong>Select RDS DB instance</strong> to configure it.</p><p><img loading="lazy" alt="Select RDS DB instance" src="/assets/images/mysql_migration_select_rds_db_instance-ef6a5f51b5d7abdc2d49986dd51dded7.png" width="1280" height="831" class="img_ev3q"></p><p>After configuration, specify a replication instance to test the connection.</p><p><img loading="lazy" alt="Test connection" src="/assets/images/mysql_migration_test_connection-b3990998a5830deaedc4e7131151e37b.png" width="1280" height="387" class="img_ev3q"></p></li><li><p>Create migration tasks.</p><p><img loading="lazy" alt="Create task" src="/assets/images/mysql_migration_create_task-936797b08367d797530b064706a60f9e.png" width="1280" height="389" class="img_ev3q"></p><p>Click <strong>Create task</strong> and configure the task according to the instructions. </p><p>Pay attention to the following parameters.</p><ul><li><p>Migration Type</p><p> <img loading="lazy" alt="Migration type" src="/assets/images/mysql_migration_migration_type-f8dc74f97f95e8d79bb176f481b7beed.png" width="1248" height="322" class="img_ev3q"></p><p> AWS DMS provides three migration types: </p><ul><li>Migrate existing data: AWS DMS migrates only your existing data. Changes to your source data aren’t captured and applied to your target. </li><li>Migrate existing data and replicate ongoing changes: AWS DMS migrates both existing data and ongoing data changes, i.e. the existing data before the migration task and the data changes during the migration task will be synchronized to the target instance.</li><li>Replicate data changes only: AWS DMS only migrates the ongoing data changes. If you select this type, you can use <strong>CDC start mode for source transactions</strong> to specify a location and migrate the data changes.
For this tutorial, select <strong>Migrate existing data and replicate ongoing changes</strong>.</li></ul></li><li><p>Target table preparation mode</p><p><img loading="lazy" alt="Target table preparation mode" src="/assets/images/mysql_migration_target_table_preparation_mode-e80c2b2c34c5d33fe435ffadb7c8d94a.png" width="1280" height="507" class="img_ev3q"></p><p>The target table preparation mode specifies the initial mode of the data structure. You can click Info beside the options to view the definition of each mode. For example, if ApeCloud MySQL is a newly created empty instance, you can select <strong>Do nothing</strong> mode.
In addition, create a database on ApeCloud MySQL before migration because AWS DMS does not create a database.</p></li><li><p>Turn on validation</p><p>It is recommended to enable this function.</p><p><img loading="lazy" alt="Turn on validation" src="/assets/images/mysql_migration_turn_on_validation-e26223cf2a54e623a4a483027c91f9ee.png" width="1280" height="229" class="img_ev3q"></p></li><li><p>Batch-optimized apply</p><p>It is recommended to enable this function as this function enables you to write target instances in batch and can improve the write speed.</p><p><img loading="lazy" alt="Batch-optimized apply" src="/assets/images/mysql_migration_batch_optimized_apply-f4a699285cb501415bc6b6fcddc3eba3.png" width="1240" height="270" class="img_ev3q"></p></li><li><p>Full load tuning settings: Maximum number of tables to load in parallel</p><p>This number decides how many concurrencies DMS uses to get source table data. Theoretically speaking, this will cause pressure on the source table during the full-load migration. Lower this number when the business in the source table is delicate.</p><p><img loading="lazy" alt="Full load tuning settings" src="/assets/images/mysql_migration_full_load_tuning_settings-b035c66065288ef577f063442687cd82.png" width="1280" height="232" class="img_ev3q"></p></li><li><p>Table Mapping</p><p>Table mapping decides which tables in the database are used for migration and can also apply easy conversions. It is recommended to enable <strong>Wizard</strong> mode to configure this parameter.</p></li></ul></li><li><p>Click the button to start the migration task.</p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-switch-applications">Step 3. Switch applications<a href="#step-3-switch-applications" class="hash-link" aria-label="Direct link to Step 3. Switch applications" title="Direct link to Step 3. Switch applications">​</a></h2><p><strong><em>Before you start</em></strong></p><ul><li>DMS migration tasks run normally. If you perform a validation task, make sure the results are as expected.</li><li>To differentiate conversation and improve data security, it is recommended to create and authorize a database account solely for migration. </li><li>It is recommended to switch applications during business off-peak hours because for the sake of safety during the switching process, it is necessary to stop business write.</li></ul><p><strong><em>Steps:</em></strong></p><ol><li><p>Make sure the transmission task runs normally.</p><p>Pay attention to <strong>Status</strong>, <strong>Last updated in Table statistics</strong>, and <strong>CDC latency target</strong> in <strong>CloudWatch metrics</strong>.</p><p>You can also refer to <a href="https://aws.amazon.com/premiumsupport/knowledge-center/dms-stuck-task-progress/?nc1=h_ls" target="_blank" rel="noopener noreferrer">this document</a> to verify the migration task.</p><p><img loading="lazy" alt="Status" src="/assets/images/mysql_migration_application_status-57938f126fc4fc9c21e416f6d451792f.png" width="1280" height="649" class="img_ev3q"></p><p><img loading="lazy" alt="CDC" src="/assets/images/mysql_migration_application_cdc-3aaf1d76bbd55ac070188f40b63f3d46.png" width="1280" height="713" class="img_ev3q"></p></li><li><p>Pause business and prohibit new business write in the source database.</p></li><li><p>Verify the transmission task status again to make sure the task runs normally and the running status lasts at least 1 minute.
Refer to step 1 above to observe whether the link is normal and whether latency exists.</p></li><li><p>Use the target database to resume business.</p></li><li><p>Verify the migration with business.</p></li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apecloud/kubeblocks/tree/main/docs/user_docs/kubeblocks-for-mysql/migration/migration.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/preview/user_docs/kubeblocks-for-mysql/high-availability"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Failure simulation and automatic recovery</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/preview/user_docs/kubeblocks-for-postgresql/cluster-management/create-and-connect-a-postgresql-cluster"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Create and connect</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#step-1-network-configuration" class="table-of-contents__link toc-highlight">Step 1. Network configuration</a><ul><li><a href="#expose-the-target-apecloud-mysql-network" class="table-of-contents__link toc-highlight">Expose the target ApeCloud MySQL network</a></li><li><a href="#expose-the-source-network" class="table-of-contents__link toc-highlight">Expose the source network</a></li></ul></li><li><a href="#step-2-configure-aws-dms-tasks" class="table-of-contents__link toc-highlight">Step 2. Configure AWS DMS tasks</a></li><li><a href="#step-3-switch-applications" class="table-of-contents__link toc-highlight">Step 3. Switch applications</a></li></ul></div></div></div><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Products</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/">KubeBlocks</a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/preview/user_docs/introduction">Docs</a></li><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/">Community</a></li></ul></div><div class="col footer__col"><div class="footer__title">Company</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/">About us</a></li><li class="footer__item"><a class="footer__link-item" href="/">News</a></li></ul></div><div class="col footer__col"><div class="footer__title">Contact us</div><ul class="footer__items clean-list"><li class="footer__item">
              <span class="contact-span">
                <a href="/" target="_blank" rel="noreferrer noopener" aria-label="Deploys by Netlify">
                  Email
                </a>
              </span>
            </li><li class="footer__item">
              <span class="contact-span">
                <a href="https://twitter.com" target="_blank" rel="noreferrer noopener" aria-label="Deploys by Netlify">
                  Twitter
                </a>
              </span>
            </li><li class="footer__item">
              <span class="contact-span">
                <a href="https://slack.com/" target="_blank" rel="noreferrer noopener" aria-label="Deploys by Netlify">
                  Slack
                </a>
              </span>
            </li><li class="footer__item">
              <span class="contact-span">
                <a href="http://www.linkedin.com/" target="_blank" rel="noreferrer noopener" aria-label="Deploys by Netlify">
                  Linkedin
                </a>
              </span>
            </li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a class="footerLogoLink_BH7S" href="/"><img src="/img/logo.png" alt="Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo" width="72" height="18"><img src="/img/logo.png" alt="Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo" width="72" height="18"></a></div><div class="footer__copyright">© 2022 ApeCloud Co., Ltd.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.3b99a02e.js"></script>
<script src="/assets/js/main.13f99fa4.js"></script>
</body>
</html>