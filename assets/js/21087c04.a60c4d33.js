"use strict";(self.webpackChunkkubeblocks_io=self.webpackChunkkubeblocks_io||[]).push([[4239],{3905:(e,t,a)=>{a.d(t,{Zo:()=>i,kt:()=>d});var r=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},s=Object.keys(e);for(r=0;r<s.length;r++)a=s[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)a=s[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var p=r.createContext({}),c=function(e){var t=r.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},i=function(e){var t=c(e.components);return r.createElement(p.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},k=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,s=e.originalType,p=e.parentName,i=o(e,["components","mdxType","originalType","parentName"]),u=c(a),k=n,d=u["".concat(p,".").concat(k)]||u[k]||m[k]||s;return a?r.createElement(d,l(l({ref:t},i),{},{components:a})):r.createElement(d,l({ref:t},i))}));function d(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var s=a.length,l=new Array(s);l[0]=k;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o[u]="string"==typeof e?e:n,l[1]=o;for(var c=2;c<s;c++)l[c]=a[c];return r.createElement.apply(null,l)}return r.createElement.apply(null,a)}k.displayName="MDXCreateElement"},1021:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>m,frontMatter:()=>s,metadata:()=>o,toc:()=>c});var r=a(7462),n=(a(7294),a(3905));const s={title:"Start/Stop a MySQL cluster",description:"How to start/stop a MySQL cluster",sidebar_position:5},l="Start/Stop MySQL Cluster",o={unversionedId:"user_docs/kubeblocks-for-mysql/cluster-management/start-stop-a-cluster",id:"user_docs/kubeblocks-for-mysql/cluster-management/start-stop-a-cluster",title:"Start/Stop a MySQL cluster",description:"How to start/stop a MySQL cluster",source:"@site/docs/user_docs/kubeblocks-for-mysql/cluster-management/start-stop-a-cluster.md",sourceDirName:"user_docs/kubeblocks-for-mysql/cluster-management",slug:"/user_docs/kubeblocks-for-mysql/cluster-management/start-stop-a-cluster",permalink:"/docs/user_docs/kubeblocks-for-mysql/cluster-management/start-stop-a-cluster",draft:!1,editUrl:"https://github.com/apecloud/kubeblocks/tree/main/docs/user_docs/kubeblocks-for-mysql/cluster-management/start-stop-a-cluster.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{title:"Start/Stop a MySQL cluster",description:"How to start/stop a MySQL cluster",sidebar_position:5},sidebar:"docs",previous:{title:"Restart MySQL cluster",permalink:"/docs/user_docs/kubeblocks-for-mysql/cluster-management/restart-mysql-cluster"},next:{title:"Delete a MySQL Cluster",permalink:"/docs/user_docs/kubeblocks-for-mysql/cluster-management/delete-mysql-cluster"}},p={},c=[{value:"How KubeBlocks starts/stops a cluster",id:"how-kubeblocks-startsstops-a-cluster",level:2},{value:"Steps",id:"steps",level:2}],i={toc:c},u="wrapper";function m(e){let{components:t,...s}=e;return(0,n.kt)(u,(0,r.Z)({},i,s,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"startstop-mysql-cluster"},"Start/Stop MySQL Cluster"),(0,n.kt)("p",null,"You can stop/start a cluster to save computing resources. When a cluster is stopped, the computing resources of this cluster are released, which means the pods of Kubernetes are released, but the storage resources are reserved. Start this cluster again if you want to restore the cluster resources from the original storage by snapshots."),(0,n.kt)("h2",{id:"how-kubeblocks-startsstops-a-cluster"},"How KubeBlocks starts/stops a cluster"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"How KubeBlocks stops a cluster")),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Stop a cluster",src:a(1070).Z,width:"1528",height:"934"})),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"A user creates a stop OpsRequest CR."),(0,n.kt)("li",{parentName:"ol"},"The stop OpsRequest CR passes the webhook validation. "),(0,n.kt)("li",{parentName:"ol"},"The OpsRequest controller saves the snapshot of the current component replicas in ",(0,n.kt)("inlineCode",{parentName:"li"},"cluster.annotations")," and sets the replicas of all components as 0."),(0,n.kt)("li",{parentName:"ol"},"The OpsRequest controller updates the cluster phase to ",(0,n.kt)("inlineCode",{parentName:"li"},"Stopping"),"."),(0,n.kt)("li",{parentName:"ol"},"The cluster controller watches the cluster CR."),(0,n.kt)("li",{parentName:"ol"},"The cluster controller scales the replicas down to 0."),(0,n.kt)("li",{parentName:"ol"},"The component controller watches the StatefulSet/Deployment and pods."),(0,n.kt)("li",{parentName:"ol"},"The Kubernetes StatefulSet/Deployment controller scales the pods down to 0."),(0,n.kt)("li",{parentName:"ol"},"After the pods are deleted, the component controller updates the cluster component phase to ",(0,n.kt)("inlineCode",{parentName:"li"},"Stopped"),"."),(0,n.kt)("li",{parentName:"ol"},"The cluster controller watches the component phase change and if all components are ",(0,n.kt)("inlineCode",{parentName:"li"},"Stopped"),", the cluster controller updates the cluster phase to ",(0,n.kt)("inlineCode",{parentName:"li"},"Stopped"),"."),(0,n.kt)("li",{parentName:"ol"},"The OpsRequest controller reconciles the status when the cluster component status changes.")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"How KubeBlocks sarts a cluster")),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Start a cluster",src:a(2339).Z,width:"1474",height:"954"})),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"A user creates a stop OpsRequest CR."),(0,n.kt)("li",{parentName:"ol"},"The start OpsRequest CR passes the webhook validation."),(0,n.kt)("li",{parentName:"ol"},"The OpsRequest controller restores all component replicas to the ones before they are stopped based on the snapshot of component replicas in ",(0,n.kt)("inlineCode",{parentName:"li"},"cluster.annotations"),"."),(0,n.kt)("li",{parentName:"ol"},"The OpsRequest controller updates the cluster phase to ",(0,n.kt)("inlineCode",{parentName:"li"},"Starting"),"."),(0,n.kt)("li",{parentName:"ol"},"The cluster controller watches the cluster CR."),(0,n.kt)("li",{parentName:"ol"},"The cluster controller changes the replicas of the StatefulSet/Deployment to the corresponding ones."),(0,n.kt)("li",{parentName:"ol"},"The component controller watches the StatefulSet/Deployment and Pods."),(0,n.kt)("li",{parentName:"ol"},"The Kubernetes StatefulSet/Deployment controller creates pods."),(0,n.kt)("li",{parentName:"ol"},"After pods are created, the component controller updates the cluster component phase to ",(0,n.kt)("inlineCode",{parentName:"li"},"Running"),"."),(0,n.kt)("li",{parentName:"ol"},"The cluster controller watches the component phase change and if all components are ",(0,n.kt)("inlineCode",{parentName:"li"},"Running"),", the cluster controller updates the cluster phase to ",(0,n.kt)("inlineCode",{parentName:"li"},"Running"),"."),(0,n.kt)("li",{parentName:"ol"},"The OpsRequest controller reconciles the status when the cluster component status changes.")),(0,n.kt)("h2",{id:"steps"},"Steps"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Stop a cluster"),(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Option 1.")," (Recommended) Use ",(0,n.kt)("inlineCode",{parentName:"p"},"kbcli")),(0,n.kt)("p",{parentName:"li"},"Configure the name of your cluster and run the command below to stop this cluster. "),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"kbcli cluster stop <name>\n")),(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},(0,n.kt)("em",{parentName:"strong"},"Example"))),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"kbcli cluster stop mysql-cluster\n")),(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Option 2.")," Create an OpsRequest"),(0,n.kt)("p",{parentName:"li"},"Run the command below to stop a cluster."),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl apply -f - <<EOF\napiVersion: apps.infracreate.com/v1alpha1\nkind: OpsRequest\nmetadata:\n  generate-name: stop-\nspec:\n  # cluster ref\n  clusterRef: mysql-cluster\n  type: Stop\nEOF\n")),(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Option 3.")," Change the YAML file of the cluster"),(0,n.kt)("p",{parentName:"li"},"Configure replicas as 0 to delete pods."),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: apps.kubeblocks.io/v1alpha1\nkind: Cluster\nmetadata:\n   name: mysql-cluster\nspec:\n   clusterDefinitionRef: apecloud-mysql\n   clusterVersionRef: ac-mysql-8.0.30\n   terminationPolicy: WipeOut\n   components:\n   - name: mysql\n     type: mysql\n     monitor: false  \n     replicas: 0\n     volumeClaimTemplates:\n   - name: data\n     spec:\n       storageClassName: standard\n       accessModes:\n         - ReadWriteOnce\n       resources:\n         requests:\n           storage: 1Gi\n"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Start a cluster"),(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Option 1.")," (Recommended) Use ",(0,n.kt)("inlineCode",{parentName:"p"},"kbcli")),(0,n.kt)("p",{parentName:"li"},"Configure the name of your cluster and run the command below to stop this cluster. "),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"kbcli cluster start <name>\n")),(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},(0,n.kt)("em",{parentName:"strong"},"Example"))),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"kbcli cluster start mysql-cluster\n")),(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Option 2.")," Create an OpsRequest"),(0,n.kt)("p",{parentName:"li"},"Run the command below to start a cluster."),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl apply -f - <<EOF\napiVersion: apps.infracreate.com/v1alpha1\nkind: OpsRequest\nmetadata:\n  generate-name: start-\nspec:\n  # cluster ref\n  clusterRef: mysql-cluster\n  type: Start\nEOF \n")),(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Option 3.")," Change the YAML file of the cluster"),(0,n.kt)("p",{parentName:"li"},"Change replicas back to the original amount to start this cluster again."),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: apps.kubeblocks.io/v1alpha1\nkind: Cluster\nmetadata:\n  name: mysql-cluster\nspec:\n   clusterDefinitionRef: apecloud-mysql\n   clusterVersionRef: ac-mysql-8.0.30\n   terminationPolicy: WipeOut\n   components:\n   - name: mysql\n     type: mysql\n     monitor: false  \n     replicas: 3\n     volumeClaimTemplates:\n     - name: data\n       spec:\n       storageClassName: standard\n       accessModes:\n         - ReadWriteOnce\n       resources:\n         requests:\n           storage: 1Gi\n")))))}m.isMDXComponent=!0},2339:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/mysql_cluster_start-e809a056080b1d723e9e543395daa4f1.png"},1070:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/mysql_cluster_stop-b32d2390ae2b946e5a95e3322dda104f.png"}}]);