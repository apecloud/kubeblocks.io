"use strict";(self.webpackChunkkubeblocks_io=self.webpackChunkkubeblocks_io||[]).push([[2592],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>d});var s=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,s,r=function(e,t){if(null==e)return{};var n,s,r={},a=Object.keys(e);for(s=0;s<a.length;s++)n=a[s],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)n=a[s],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=s.createContext({}),c=function(e){var t=s.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=c(e.components);return s.createElement(i.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return s.createElement(s.Fragment,{},t)}},g=s.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,i=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),u=c(n),g=r,d=u["".concat(i,".").concat(g)]||u[g]||m[g]||a;return n?s.createElement(d,l(l({ref:t},p),{},{components:n})):s.createElement(d,l({ref:t},p))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,l=new Array(a);l[0]=g;var o={};for(var i in t)hasOwnProperty.call(t,i)&&(o[i]=t[i]);o.originalType=e,o[u]="string"==typeof e?e:r,l[1]=o;for(var c=2;c<a;c++)l[c]=n[c];return s.createElement.apply(null,l)}return s.createElement.apply(null,n)}g.displayName="MDXCreateElement"},6041:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>m,frontMatter:()=>a,metadata:()=>o,toc:()=>c});var s=n(87462),r=(n(67294),n(3905));const a={title:"Access logs",description:"How to access cluster log files",sidebar_position:3},l="Access logs",o={unversionedId:"user_docs/kubeblocks-for-postgresql/observability/access-logs",id:"version-release-0.4/user_docs/kubeblocks-for-postgresql/observability/access-logs",title:"Access logs",description:"How to access cluster log files",source:"@site/versioned_docs/version-release-0.4/user_docs/kubeblocks-for-postgresql/observability/access-logs.md",sourceDirName:"user_docs/kubeblocks-for-postgresql/observability",slug:"/user_docs/kubeblocks-for-postgresql/observability/access-logs",permalink:"/docs/release-0.4/user_docs/kubeblocks-for-postgresql/observability/access-logs",draft:!1,editUrl:"https://github.com/apecloud/kubeblocks/tree/release-0.4/docs/user_docs/kubeblocks-for-postgresql/observability/access-logs.md",tags:[],version:"release-0.4",sidebarPosition:3,frontMatter:{title:"Access logs",description:"How to access cluster log files",sidebar_position:3},sidebar:"docs",previous:{title:"Configure IM alert",permalink:"/docs/release-0.4/user_docs/kubeblocks-for-postgresql/observability/alert"},next:{title:"Overview",permalink:"/docs/release-0.4/user_docs/connect_database/overview-of-database-connection"}},i={},c=[{value:"Before you start",id:"before-you-start",level:2},{value:"Steps",id:"steps",level:2}],p={toc:c},u="wrapper";function m(e){let{components:t,...n}=e;return(0,r.kt)(u,(0,s.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"access-logs"},"Access logs"),(0,r.kt)("p",null,"The KubeBlocks log enhancement function aims to simplify the complexities of troubleshooting. With kbcli, the command line tool of KubeBlocks, you can view all kinds of logs generated by the database clusters running on KubeBlocks, such as slow logs, error logs, audit logs, and the container running logs (Stdout and Stderr).\nThe KubeBlocks log enhancement function uses methods similar to kubectl exec and kubectl logs to ensure a self-closed loop and lightweight."),(0,r.kt)("h2",{id:"before-you-start"},"Before you start"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The container image supports ",(0,r.kt)("inlineCode",{parentName:"li"},"tail")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"xargs")," commands."),(0,r.kt)("li",{parentName:"ul"},"KubeBlocks Operator is installed on the target Kubernetes cluster.")),(0,r.kt)("h2",{id:"steps"},"Steps"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Enable the log enhancement function."),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"If you create a cluster by running the ",(0,r.kt)("inlineCode",{parentName:"p"},"kbcli cluster create")," command, add the ",(0,r.kt)("inlineCode",{parentName:"p"},"--enable-all-logs=true")," option to enable the log enhancement function. When this option is ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),", all the log types defined by ",(0,r.kt)("inlineCode",{parentName:"p"},"spec.components.logConfigs")," in ",(0,r.kt)("inlineCode",{parentName:"p"},"ClusterDefinition")," are enabled automatically."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kbcli cluster create pg-cluster --cluster-definition='postgresql' --enable-all-logs=true \n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"If you create a cluster by applying a YAML file, add the log type you need in ",(0,r.kt)("inlineCode",{parentName:"p"},"spec.components.enabledLogs"),". As for PostgreSQL, running log is supported."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-YAML"},"apiVersion: apps.kubeblocks.io/v1alpha1\nkind: Cluster\nmetadata:\n  name: pg-cluster\n  namespace: default\nspec:\n  clusterDefinitionRef: postgresql-cluster-definition\n  appVersionRef: appversion-postgresql-latest\n  components:\n  - name: replicasets\n    type: replicasets\n    enabledLogs:\n      - running\n"))))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"View the supported logs."),(0,r.kt)("p",{parentName:"li"},"Run the ",(0,r.kt)("inlineCode",{parentName:"p"},"kbcli cluster list-logs")," command to view the enabled log types of the target cluster and the log file details. INSTANCE of each node is displayed."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"Example"))),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kbcli cluster list-logs pg-cluster\n>\nINSTANCE                         LOG-TYPE        FILE-PATH                                          SIZE    LAST-WRITTEN                      COMPONENT\npg-cluster-postgresql-0-0        running         /postgresql/data/log/postgresql-2023-03-03.csv     6.9K    Mar 03, 2023 07:17 (UTC+00:00)    postgresql\npg-cluster-postgresql-0-0        running         /postgresql/data/log/postgresql-2023-03-03.log     326     Mar 03, 2023 07:17 (UTC+00:00)    postgresql         \n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Access the cluster log file."),(0,r.kt)("p",{parentName:"li"},"Run the ",(0,r.kt)("inlineCode",{parentName:"p"},"kbcli cluster logs <name>")," command to view the details of the target log file generated by the target instance on the target cluster. You can use different options to view the log file details you need.\nYou can also run ",(0,r.kt)("inlineCode",{parentName:"p"},"kbcli cluster logs -h")," to see the examples and option descriptions.   "),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kbcli cluster logs -h\n>\nAccess cluster log file\n\nExamples:\n  # Return snapshot logs from cluster mycluster with default primary instance (stdout)\n  kbcli cluster logs mycluster\n\n  # Display only the most recent 20 lines from cluster mycluster with default primary instance (stdout)\n  kbcli cluster logs --tail=20 mycluster\n\n  # Return snapshot logs from cluster mycluster with specify instance my-instance-0 (stdout)\n  kbcli cluster logs mycluster --instance my-instance-0\n\n  # Return snapshot logs from cluster mycluster with specify instance my-instance-0 and specify container\n  # my-container (stdout)\n  kbcli cluster logs mycluster --instance my-instance-0 -c my-container\n\n  # Return slow logs from cluster mycluster with default primary instance\n  kbcli cluster logs mycluster --file-type=slow\n\n  # Begin streaming the slow logs from cluster mycluster with default primary instance\n  kbcli cluster logs -f mycluster --file-type=slow\n\n  # Return the specify file logs from cluster mycluster with specify instance my-instance-0\n  kbcli cluster logs mycluster --instance my-instance-0 --file-path=/var/log/yum.log\n\n  # Return the specify file logs from cluster mycluster with specify instance my-instance-0 and specify\n  # container my-container\n  kbcli cluster logs mycluster --instance my-instance-0 -c my-container --file-path=/var/log/yum.log\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"(Optional) Troubleshooting."),(0,r.kt)("p",{parentName:"li"}," The log enhancement function does not affect the core process of KubeBlocks. If a configuration exception occurs, a warning shows to help troubleshoot.\n",(0,r.kt)("inlineCode",{parentName:"p"},"warning")," is recorded in the ",(0,r.kt)("inlineCode",{parentName:"p"},"event")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"status.Conditions")," of the target database cluster. "),(0,r.kt)("p",{parentName:"li"}," View ",(0,r.kt)("inlineCode",{parentName:"p"},"warning")," information."),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Run ",(0,r.kt)("inlineCode",{parentName:"p"},"kbcli cluster describe <cluster-name>")," to view the status of the target cluster. You can also run ",(0,r.kt)("inlineCode",{parentName:"p"},"kbcli cluster list events <cluster-name>")," to view the event information of the target cluster directly.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Run ",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl describe cluster <cluster-name>")," to view the warning."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"Example"))),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"Status:\n  Cluster Def Generation:  3\n  Components:\n     Replicasets:\n       Phase:  Running\n  Conditions:\n    Last Transition Time:  2022-11-11T03:57:42Z\n    Message:               EnableLogs of cluster component replicasets has invalid value [errora slowa] which isn't defined in cluster definition component replicasets\n    Reason:                EnableLogsListValidateFail\n    Status:                False\n    Type:                  ValidateEnabledLogs\n  Observed Generation:     2\n  Operations:\n    Horizontal Scalable:\n       Name:  replicasets\n    Restartable:\n      replicasets\n    Vertical Scalable:\n      replicasets\n  Phase:  Running\nEvents:\n  Type     Reason                      Age   From                Message\n  ----     ------                      ----  ----                -------\n  Normal   Creating                    49s   cluster-controller  Start Creating in Cluster: release-name-error\n  Warning  EnableLogsListValidateFail  49s   cluster-controller  EnableLogs of cluster component replicasets has invalid value [errora slowa] which isn't defined in cluster definition component replicasets\n  Normal   Running                     36s   cluster-controller  Cluster: release-name-error is ready, current phase is Running\n")))))))}m.isMDXComponent=!0}}]);