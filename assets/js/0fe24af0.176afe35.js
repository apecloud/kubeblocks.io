"use strict";(self.webpackChunkkubeblocks_io=self.webpackChunkkubeblocks_io||[]).push([[6753],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>u});var n=a(67294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=n.createContext({}),c=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},b=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(a),b=o,u=d["".concat(s,".").concat(b)]||d[b]||m[b]||r;return a?n.createElement(u,i(i({ref:t},p),{},{components:a})):n.createElement(u,i({ref:t},p))}));function u(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,i=new Array(r);i[0]=b;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:o,i[1]=l;for(var c=2;c<r;c++)i[c]=a[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}b.displayName="MDXCreateElement"},10199:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>m,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var n=a(87462),o=(a(67294),a(3905));const r={title:"Monitor database",description:"How to monitor your database",sidebar_position:1},i="Observability of KubeBlocks",l={unversionedId:"user_docs/kubeblocks-for-mysql/observability/monitor-database",id:"version-release-0.4/user_docs/kubeblocks-for-mysql/observability/monitor-database",title:"Monitor database",description:"How to monitor your database",source:"@site/versioned_docs/version-release-0.4/user_docs/kubeblocks-for-mysql/observability/monitor-database.md",sourceDirName:"user_docs/kubeblocks-for-mysql/observability",slug:"/user_docs/kubeblocks-for-mysql/observability/monitor-database",permalink:"/docs/release-0.4/user_docs/kubeblocks-for-mysql/observability/monitor-database",draft:!1,editUrl:"https://github.com/apecloud/kubeblocks/tree/release-0.4/docs/user_docs/kubeblocks-for-mysql/observability/monitor-database.md",tags:[],version:"release-0.4",sidebarPosition:1,frontMatter:{title:"Monitor database",description:"How to monitor your database",sidebar_position:1},sidebar:"docs",previous:{title:"MySQL Paxos Group",permalink:"/docs/release-0.4/user_docs/kubeblocks-for-mysql/backup-and-restore/backup-and-restore-for-mysql-paxos-group"},next:{title:"Configure IM alert",permalink:"/docs/release-0.4/user_docs/kubeblocks-for-mysql/observability/alert"}},s={},c=[{value:"Enable database monitor",id:"enable-database-monitor",level:2}],p={toc:c},d="wrapper";function m(e){let{components:t,...a}=e;return(0,o.kt)(d,(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"observability-of-kubeblocks"},"Observability of KubeBlocks"),(0,o.kt)("p",null,"With the built-in database observability, you can observe the database health status and track and measure your database in real-time to optimize database performance. This section shows you how database observability works with KubeBlocks and how to use the function."),(0,o.kt)("h2",{id:"enable-database-monitor"},"Enable database monitor"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"Steps:"))),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Install KubeBlocks and the monitoring add-ons are installed by default."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"kbcli kubeblocks install\n")),(0,o.kt)("p",{parentName:"li"},"If you do not want to enable the monitoring add-ons when installing KubeBlocks, set ",(0,o.kt)("inlineCode",{parentName:"p"},"--monitor")," to cancel the add-on installation. But it is not recommended to disable the monitoring function."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"kbcli kubeblocks install --monitor=false\n")),(0,o.kt)("p",{parentName:"li"},"If you have installed KubeBlocks without the monitoring add-ons, you can use ",(0,o.kt)("inlineCode",{parentName:"p"},"kbcli addon")," to enable the monitoring add-ons. To ensure the completeness of the monitoring function, it is recommended to enable three monitoring add-ons. "),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"# View all add-ons supported\nkbcli addon list\n\n# Enable prometheus add-on\nkbcli addon enable prometheus\n\n# Enable granfana add-on\nkbcli addon enable granfana\n\n# Enable alertmanager-webhook-adaptor add-on\nkbcli addon enable alertmanager-webhook-adaptor\n")),(0,o.kt)("admonition",{parentName:"li",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Refer to ",(0,o.kt)("a",{parentName:"p",href:"/docs/release-0.4/user_docs/installation/enable-add-ons"},"Enable add-ons")," for details."))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"View the Web Console of the monitoring components."),(0,o.kt)("p",{parentName:"li"},"Run the command below to view the Web Console list of the monitoring components after the components are installed."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"kbcli dashboard list\n>\nNAME                                      NAMESPACE        PORT        CREATED-TIME\nkubeblocks-grafana                        default          3000        Jan 13,2023 10:53 UTC+0800\nkubeblocks-prometheus-alertmanager        default          9093        Jan 13,2023 10:53 UTC+0800\nkubeblocks-prometheus-server              default          9090        Jan 13,2023 10:53 UTC+0800\n")),(0,o.kt)("p",{parentName:"li"},"For the Web Console list returned by the above command, if you want to view the Web Console of a specific monitoring component, run the command below and this command enables the port-forward of your local host and opens the default browser:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"kbcli dashboard open <name>\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Enable the database monitoring function."),(0,o.kt)("p",{parentName:"li"}," The monitoring function is enabled by default when a database is created. The open-source or customized Exporter is injected after the monitoring function is enabled. This Exporter can be found by Prometheus server automatically and scrape monitoring indicators at regular intervals. "),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"For a new cluster, run the command below to create a database cluster."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"# Search the cluster definition\nkbcli clusterdefinition list \n\n# Create a cluster\nkbcli cluster create <name> --cluster-definition='xxx'\n")),(0,o.kt)("p",{parentName:"li"},"   ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"Example"))),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"kbcli cluster create mysql-cluster --cluster-definition='apecloud-mysql'\n")),(0,o.kt)("admonition",{parentName:"li",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"The setting of ",(0,o.kt)("inlineCode",{parentName:"p"},"monitor")," is ",(0,o.kt)("inlineCode",{parentName:"p"},"true")," by default and it is not recommended to disable it. For example,"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"kbcli cluster create mycluster --cluster-definition='apecloud-mysql' --monitor=false\n"))),(0,o.kt)("p",{parentName:"li"},"   You can change the value to ",(0,o.kt)("inlineCode",{parentName:"p"},"false")," to disable the monitor function if required.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"For the existing cluster, you can update it to enable the monitor function with ",(0,o.kt)("inlineCode",{parentName:"p"},"update")," command."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"kbcli cluster update <name> --monitor=true\n")),(0,o.kt)("p",{parentName:"li"},"  ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"Example"))),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"kbcli cluster update mysql-cluster --monitor=true\n")))))),(0,o.kt)("p",null,"You can view the dashboard of the corresponding cluster via Grafana Web Console. For more detailed information, see ",(0,o.kt)("a",{parentName:"p",href:"https://grafana.com/docs/grafana/latest/dashboards/"},"Grafana documentation"),"."))}m.isMDXComponent=!0}}]);